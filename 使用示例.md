# 机器人控制器使用示例

本文档展示如何使用更新后的 `totalController.py` 控制机器人。

## 快速开始

### 基本使用（推荐 - 使用上下文管理器）

```python
from totalController import Controller

# 使用with语句，自动管理资源
with Controller(("192.168.1.120", 43893)) as robot:
    # 完整初始化（启动心跳、初始化关节、起立、切换模式）
    robot.initialize()
    
    # 前进
    robot.start_continuous_move(forward_speed=0.3)
    time.sleep(2)
    robot.stop_continuous_move()
    
# 离开with块时自动清理资源
```

### 手动管理资源

```python
from totalController import Controller

# 创建控制器
robot = Controller(("192.168.1.120", 43893))

# 手动启动心跳
robot.start_heartbeat(frequency=2.0)

# 初始化关节
robot.init_robot()

# 使用完毕后手动关闭
robot.close()
```

## 核心功能

### 1. 完整初始化流程

```python
with Controller((ROBOT_IP, ROBOT_PORT)) as robot:
    # 一键完成所有初始化步骤
    robot.initialize()
    # 包括：启动心跳 → 初始化关节 → 起立 → 切换到移动模式
```

### 2. 自动心跳维护

```python
# 启动心跳线程（频率 > 1Hz）
robot.start_heartbeat(frequency=2.0)  # 默认2Hz

# 停止心跳
robot.stop_heartbeat()
```

### 3. 持续移动（20Hz频率）

```python
# 启动持续移动（满足文档要求的20Hz频率）
robot.start_continuous_move(forward_speed=0.3, turn_speed=0.2)

# 更新移动参数（无需停止）
robot.start_continuous_move(forward_speed=0.5)

# 停止持续移动
robot.stop_continuous_move()
```

### 4. 单次移动指令

```python
# 发送单次移动指令（需要循环调用保持运动）
robot.move(forward_speed=0.3, side_speed=0.0, turn_speed=0.2)
```

## 常用动作示例

### 语音指令

```python
# 打招呼
robot.voice_command("GREET")

# 头部动作
robot.voice_command("HEAD_DOWN")  # 低头
robot.voice_command("HEAD_UP")    # 抬头
robot.voice_command("LOOK_LEFT")  # 向左看
robot.voice_command("LOOK_RIGHT") # 向右看

# 站立控制
robot.voice_command("STAND")  # 起立
robot.voice_command("STOP")   # 停止
```

### 步态切换

```python
# 切换步态
robot.set_gait('low')       # 低速步态
robot.set_gait('medium')    # 中速步态
robot.set_gait('high')      # 高速步态
robot.set_gait('grasp')     # 抓地步态
robot.set_gait('general')   # 通用步态
robot.set_gait('high_step') # 高踏步步态
```

### 模式切换

```python
# 切换运动模式
robot.switch_to_move_mode()  # 移动模式
robot.switch_to_stay_mode()  # 原地模式
```

### 复杂运动

```python
# 组合运动：前进同时右转
robot.start_continuous_move(forward_speed=0.3, turn_speed=0.2)
time.sleep(3)
robot.stop_continuous_move()

# 侧移
robot.start_continuous_move(side_speed=0.4)
time.sleep(2)
robot.stop_continuous_move()
```

## 完整示例程序

### 示例1: 巡逻路线

```python
from totalController import Controller
import time

ROBOT_IP = "192.168.1.120"
ROBOT_PORT = 43893

with Controller((ROBOT_IP, ROBOT_PORT)) as robot:
    # 初始化
    robot.initialize()
    
    # 前进
    print("前进...")
    robot.start_continuous_move(forward_speed=0.3)
    time.sleep(3)
    
    # 右转90度
    print("右转...")
    robot.start_continuous_move(turn_speed=0.5)
    time.sleep(2)
    
    # 前进
    print("前进...")
    robot.start_continuous_move(forward_speed=0.3)
    time.sleep(3)
    
    # 停止
    robot.stop_continuous_move()
    print("巡逻完成")
```

### 示例2: 步态展示

```python
from totalController import Controller
import time

with Controller(("192.168.1.120", 43893)) as robot:
    robot.initialize()
    
    gaits = ['low', 'medium', 'high', 'high_step']
    
    for gait in gaits:
        print(f"演示{gait}步态...")
        robot.set_gait(gait)
        time.sleep(1)
        
        robot.start_continuous_move(forward_speed=0.4)
        time.sleep(3)
        robot.stop_continuous_move()
        time.sleep(2)
```

### 示例3: 互动表演

```python
from totalController import Controller
import time

with Controller(("192.168.1.120", 43893)) as robot:
    robot.initialize()
    
    # 打招呼
    print("打招呼...")
    robot.voice_command("GREET")
    time.sleep(3)
    
    # 点头
    print("点头...")
    robot.nod()
    time.sleep(2)
    
    # 摇头
    print("摇头...")
    robot.shake()
    time.sleep(2)
    
    # 转圈展示
    print("转圈...")
    robot.start_continuous_move(turn_speed=0.4)
    time.sleep(5)
    robot.stop_continuous_move()
```

## 安全提示

1. **始终使用上下文管理器**：确保资源正确释放
   ```python
   with Controller((IP, PORT)) as robot:
       # 你的代码
   # 自动清理
   ```

2. **紧急停止**：遇到危险情况
   ```python
   robot.emergency_stop()
   robot.stop_continuous_move()
   ```

3. **避免死区**：移动速度建议范围
   - 前后平移: 绝对值 > 0.2
   - 左右平移: 绝对值 > 0.38
   - 转弯: 绝对值 > 0.29

4. **保持心跳**：频率必须 > 1Hz（已自动维护）

## 测试程序

提供了两个测试程序：

### test_robot.py - 完整测试
```bash
python test_robot.py
```
功能：
- 快速测试模式
- 完整测试模式（所有功能）
- 交互式控制模式
- 仅初始化模式

### simple_test.py - 简单测试
```bash
python simple_test.py
```
功能：快速验证基本功能

## 更新内容

✅ **新增功能**：
1. 自动心跳维护线程（2Hz频率）
2. 完整初始化流程 `initialize()`
3. 持续移动模式（20Hz频率）
4. 异常处理机制
5. 上下文管理器支持
6. 资源清理方法 `close()`

✅ **改进**：
1. 更好的错误提示
2. 线程安全的运动控制
3. 自动资源管理
4. 完善的文档和示例

## 故障排除

**问题1**: 机器人无响应
- 检查IP和端口是否正确
- 确认网络连接
- 查看心跳是否正常发送

**问题2**: 移动不流畅
- 使用 `start_continuous_move()` 而不是单次 `move()`
- 检查速度值是否在有效范围

**问题3**: 程序无法退出
- 使用上下文管理器 `with` 语句
- 或手动调用 `robot.close()`

## 联系支持

如有问题，请查看官方文档或联系技术支持。
